<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- File generated by Telosys Tools Generator ( version 2.1.0 ) - Date 2015-12-09 ( Time 16:26:40 ) -->

<div class="wrap" style="margin: 0;">
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c"    uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="s"    uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="fn"   uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt"  uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib tagdir="/WEB-INF/tags/util" prefix="util"%>
<%@ taglib tagdir="/WEB-INF/tags/input" prefix="input"%>
<%@ taglib tagdir="/WEB-INF/tags/display" prefix="display"%>
<%@ taglib tagdir="/WEB-INF/tags/trams" prefix="trams_c"%>
<c:url value="/" var="root"></c:url>
	<div class="container">
		<div class="search_box admin_user">
			<div class="title">
				카드 선택
				<c:if test="${type == 'relatedCard'}">
				<a class="btn btn-danger" href="javascript:void(0)" onclick="returnToParent(${cards.id})">연관 카드 삭제</a>
				</c:if>
			</div>
			<div class="form-inline">
				<div class="form_group">
					<select class="form-control" id="option">
						<c:if test="${option == 1}">
							<option value="1" selected="selected">제목</option>
						</c:if>
						<c:if test="${option != 1}">
							<option value="1">제목</option>
						</c:if>
						<c:if test="${option == 2}">
							<option value="2" selected="selected">강연자</option>
						</c:if>
						<c:if test="${option != 2}">
							<option value="2" >강연자</option>
						</c:if>
					</select>
					
				
				
					<div class="input-group">
						<span class="input-group-addon" id="sizing-addon1">
							<span class="glyphicon glyphicon-search"></span>
						</span>
						<input type="text" name="keyword" value="${keyword }" class="form-control" placeholder=""  onkeypress="if(event.keyCode==13) {search(); return false;}">
						<span class="input-group-btn">
							<button class="btn btn-default" type="button" onclick="search()">검색</button>
						</span>
					</div><!-- /input-group -->
				</div>
			</div><!-- /.row -->
		</div>

		<util:message message="${message}" messages="${messages}" />

		<table class="table table-striped">
			<thead>
				<tr>
					<th width="10%">카드번호</th>
					<th width="60%">제목</th>
					<th width="20%">생성일</th>
					<th width="10%">선택</th>
				</tr>
			</thead>
			<tbody>
				<c:forEach items="${list}" var="cards">
					<tr>
						<s:url var="url_update" value="/admin/manage_cards/form/${cards.id}"/>
						<td>${cards.id}</td>
						<td>${cards.title}</td>
						<td><display:date value="${cards.createdAt}" /></td>
						<td><a class="btn btn-primary" href="javascript:void(0)" onclick="returnToParent(${cards.id})">선택</a></td>
						<s:url value="${saveAction}" var="url_form_submit" />
						<form:form  id="cards_form${cards.id}" enctype="form-data" class="form-horizontal" modelAttribute="mainList" cssClass="form-horizontal" method="POST" action="/admin/manage_recommend_cards/create/${cards.id}">
							<form:input type="hidden" path="cardId" value="${cards.id}"/>
						</form:form>
					</tr>
				</c:forEach>
			</tbody>
		</table>
		<trams_c:pagnation currentIndex="${currentIndex}" url="${url}" totalPages="${page.totalPages}" id="" />
			
		<SCRIPT type="text/javascript">
			$(function(){
				if (GetQueryStringParams('option')!=null)
				{
					$('#options option[value="'+GetQueryStringParams('option')+'"]').attr("selected",true);
				}
				
				
				
				
			});
			
			function search(){ 
					var url = "${root}admin/manage_cards/popup_search_card/recommendCard?option="+ $("#option").val() + "&keyword=" + $("input[name=keyword]").val();
					location.href = url;
			}

			

	    	function closePopup() {
	    		window.close();
	    	}
	    	
			function returnToParent(id) {
				var type = "${type}";
				
				if (type == 'relatedCard') {
					// 연관카드선택
					window.opener.$("input#cards_relatedCardId").val(id);
					window.close();
				} else if (type == 'recommendCard') {
					// 추천카드선택
					try {
						$('#cards_form'+id).ajaxSubmit({
							url : $(this).attr('action'),
							type : "POST",
							data : $(this).serialize(),
							dataType : 'json',
							success : function(data) {
								var jdata = data;
								if (jdata.success != true){
									alert(jdata.message);
								}else{
									window.opener.refreshPage();
									window.close();
								}
							},
							error : function(response) {
								alert(response);
							}
						});
						return false;
					} catch (e) {
						alert(e);
					}
				}
	    	}
			
		</SCRIPT>
	</div>
</div>