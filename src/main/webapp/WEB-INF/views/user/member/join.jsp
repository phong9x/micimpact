<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- File generated by Telosys Tools Generator ( version 2.1.1 ) - Date 2015-04-30 ( Time 14:31:38 ) -->

<div>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c"    uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="s"    uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="fn"   uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt"  uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib tagdir="/WEB-INF/tags/util" prefix="util"%>
<%@ taglib tagdir="/WEB-INF/tags/input" prefix="input"%>

	<div class="container">
		<fieldset class="group">
			<legend class="legende"><s:message code="users"/></legend>
			<util:message message="${message}" messages="${messages}" />	
			<s:url value="${saveAction}" var="url_form_submit" />
			<div class="login-card join-card">
				<h1>
					<c:choose>
						<c:when test="${mode != 'create'}">
							<s:message code="join_modify"/>
						</c:when>
						<c:otherwise>
							<s:message code="join_title"/>
						</c:otherwise>
					</c:choose>
				</h1><br>
				<form:form class="form-horizontal" id="saveForm" modelAttribute="users" method="POST" action="${url_form_submit}">
				<form:errors path="*" cssClass="alert alert-danger" element="div" />
<c:if test="${mode != 'create'}">
				<!-- Store data in hidden fields in order to be POST even if the field is disabled -->
				<form:hidden path="id" />
				<form:hidden path="createDate" />
				<form:hidden path="roleId" />
</c:if>

					<div class="row_box">
						<div class="row_group <c:if test="${mode != 'create'}">lat</c:if>">
							<span class="ps_box">
								<c:set var="id"><s:message code="common.id"/></c:set>
								<c:choose>
									<c:when test="${mode == 'create'}">
										<form:input id="not_users_username" type="text" path="username" name="username" placeholder="${id}" maxLength="255" readonly="${mode !='create'}"  />
										<input type="hidden" name="idCheckResult" id="idCheckResult"/>
										<button type="button" onclick="chekcID();"><s:message code="join.checkId"/></button>
									</c:when>
									<c:otherwise>
										<form:input id="users_username" type="text" path="username" name="username" placeholder="${id}" maxLength="255" readonly="${mode !='create'}"  />
									</c:otherwise>
								</c:choose>
							</span>
							<div class="err_msg">
								<form:errors id="users_username_errors" path="username" cssClass="label label-danger" />
							</div>
						</div>
						<div class="row_group">
							<span class="ps_box">
								<c:set var="password"><s:message code="common.password"/></c:set>
								<form:input id="users_password" type="password" name="password" placeholder="${password}" path="password" maxLength="256" value=""  />
							</span>
							<div class="err_msg">
								<form:errors id="users_password_errors" path="password" type="password" cssClass="label label-danger" />
							</div>
						</div>
						<div class="row_group lat">
							<span class="ps_box">
								<c:set var="passwordCheck"><s:message code="join.passwordCheck"/></c:set>
								<input id="users_password_check" type="password" placeholder="${passwordCheck}"  maxLength="256" />
								<!-- <img alt="비밀번호 확인" src="/images/icon/pw_re_img.png"> -->
							</span>
							<div class="err_msg">

							</div>
						</div>
					</div>
					<div class="row_box">
						<div class="row_group">
							<span class="ps_box">
								<c:set var="name"><s:message code="common.name"/></c:set>
								<form:input id="users_name" type="text" path="name" placeholder="${name}" maxLength="255" readonly="${mode !='create'}"/>
							</span>
							<div class="err_msg">
								<form:errors id="users_name_errors" path="name" cssClass="label label-danger" />
							</div>
						</div>
						<div class="row_group">
							<span class="ps_box">
								<c:set var="email"><s:message code="common.email"/></c:set>
								<form:input id="users_email" type="text" path="email" placeholder="${email}" maxLength="255"  />
							</span>
							<div class="err_msg">
								<form:errors id="users_email_errors" path="email" cssClass="label label-danger" />
							</div>
						</div>
						<div class="row_group lat">
							<span class="ps_box">
								<c:set var="phone"><s:message code="common.phone"/></c:set>
								<form:input id="users_phone" type="text" path="phone" placeholder="${phone}" maxLength="128"  />
							</span>
							<div class="err_msg">
								<form:errors id="users_phone_errors" path="phone" cssClass="label label-danger" />
							</div>
						</div>
					</div>
					<div class="btn_gp">
						<c:choose>
							<c:when test="${mode !='create'}">
								<BUTTON type="button" onclick="modifySave()"><s:message code="save"/></BUTTON>
								<BUTTON type="button" onclick="history.go(-1)"><s:message code="cancel"/></BUTTON>
							</c:when>
							<c:otherwise>
								<input type="button" onclick="signin();" id="btn_join" name="login"  class="login login-submit" value="<s:message code="join_title"/>">
							</c:otherwise>
						</c:choose>
					</div>
					<SCRIPT type="text/javascript">
						$(function(){
							$("#btn_join").click(function(){
								var pw = $("input[id=users_password]").val();
								var pwch = $("input[id=users_password_check]").val();
								var idCheckResultValue = document.getElementsByName("idCheckResult")[0].value;
								var username = $("input[name=username]").val();
								
								if(username.length == 0){
									alert('아이디를 입력해주세요.');
									document.getElementsByName("username")[0].focus();
									return false;
								}
								else if(idCheckResultValue != "true") {
									alert('아이디 중복 체크를 해주세요.');
									document.getElementsByName("idCheckImg")[0].focus();
									return false;
								}
								
								if (pw != pwch) {
									alert("입력하신 비밀번호와 비밀번호확인이 일치하지 않습니다.");
									document.getElementsByName("password")[0].focus();
									return false;
								}
								
								
								$( "#saveForm" ).submit();
								
							});
						});
						function chekcID(){
							var join_id = $("input[id=not_users_username]").val();
							
							if(!join_id || join_id == join_id.defaultValue) {
								alert('아이디를 입력해주세요.');
								document.getElementsByName("username")[0].focus();
								return false;
							}
							else if(!isKorean(join_id)) {
								alert("영문만 사용가능합니다.");
								document.getElementsByName("username")[0].focus();
								return false;
							}
							else{
								var jsonData = JSON.stringify({
									"username":join_id});
								
								$.ajax({
									type:"post",
									url:"/userIdCheck",
									data:jsonData,
									contentType:"application/json; charset=utf-8",
									dataType:"json",
									success:function(req){
										if (req.success) {
											alert(req.message);
											$('#idCheckResult').val("true");
											checkedId = join_id.value;
										}else{
											alert(req.message);
											$('#idCheckResult').val("false");
										}
									},error: function(err){
										//alert(err);
									}
								});
							}
						}
						
						
						function modifySave() {
							
							var pw = $("input[id=users_password]").val();
							var pwch = $("input[id=users_password_check]").val();
							
							if (pw.length > 0 && pw.length > 0) {								
								if (pw != pwch) {
									alert("입력하신 비밀번호와 비밀번호확인이 일치하지 않습니다.");
									document.getElementsByName("password")[0].focus();
									return false;	
								}
							}
							
							$( "#saveForm" ).submit();
						} 
					</SCRIPT>
				</form:form>
			</div>
		</fieldset>
		
	</div>	
</div>
